<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="work">
<link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC&display=swap&subset=chinese-traditional"
rel="stylesheet">
<script src="https://unpkg.com/vue@3"></script>
<script src="https://unpkg.com/luxon@2"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DGKBYYKDBT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DGKBYYKDBT');
</script>
<style>
  #app {
    font-family: 'Noto Sans TC', sans-serif;
  }
</style>
<title>work</title>
</head>
<body>
<div id="app">
  <p id="work">距離 2023/10/13 還有 {{ countdown }} 天。</p>
</div>
<div id="calendar" style="width: 1000px; height: 350px;"></div>
<script>
  var DateTime = luxon.DateTime,
    Interval = luxon.Interval;
  let betweenDays = (startDate, endDate) => {
    return Intl.NumberFormat('zh-TW').format(Interval.fromDateTimes(startDate, endDate).count('days'));
  };
  const durationSettings = ['years', 'months', 'days'],
    Taipei = { zone: 'Asia/Taipei' },
    now = DateTime.now(),
    today = DateTime.fromISO(now.toISODate()),
    futureDate = DateTime.fromSQL('2023-10-13 23:59:59', Taipei),
    untilFutureDate = betweenDays(today, futureDate);

  Vue.createApp({
    data() {
      return {
        countdown: untilFutureDate,
      }
    }
  }).mount('#app')
</script>
<script>
  google.charts.load("current", {packages:["calendar"]});
  google.charts.setOnLoadCallback(drawChart);

  var dataset = [];
  let isWorkday = (inputDate) => {
    if (inputDate.weekday >= 6) {
      return false;
    }

    return holidays.indexOf(inputDate.toFormat('yyyy-LL-dd')) < 0;
  };
  const holidays = [
    '2022-05-02',
    '2022-06-03',
    '2022-09-09',
    '2022-10-10',
    '2023-01-02',
    '2023-01-23',
    '2023-01-24',
    '2023-02-27',
    '2023-02-28',
    '2023-04-03',
    '2023-04-04',
    '2023-04-05',
    '2023-05-01',
    '2023-06-22',
    '2023-06-23',
    '2023-09-29',
    '2023-10-09',
    '2023-10-10',
  ];

  for (i = 0; i <= untilFutureDate; i ++) {
    let currentDate = today.plus({ days: i });
    let isCurrentDateWorkday = isWorkday(currentDate);
    dataset.push([currentDate.toJSDate(), ~~isCurrentDateWorkday]);
  }

  function drawChart() {
    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn({ type: 'date', id: 'Date' });
    dataTable.addColumn({ type: 'number', id: 'Workday' });
    dataTable.addRows(dataset);

    var chart = new google.visualization.Calendar(document.getElementById('calendar'));
    var options = {
      height: 350,
      calendar: {
        daysOfWeek: '日一二三四五六',
      }
    };

    chart.draw(dataTable, options);
  }
</script>
<div id="link">
  <a href="./index.html">index</a>
</div>
</body>
</html>
